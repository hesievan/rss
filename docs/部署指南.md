# RSS 日报系统部署指南

## 1. 系统概述

本系统是一个基于 GitHub Actions 的自动化 RSS 新闻筛选和飞书推送系统，主要功能包括：

- 定时从多个 RSS 源获取新闻
- 智能关键词筛选和内容过滤
- 自动生成格式化的日报内容
- 飞书机器人推送提醒

## 2. 部署步骤

### 2.1 Fork 项目

1. 访问项目 GitHub 页面
2. 点击右上角的 "Fork" 按钮
3. 选择目标仓库，完成 Fork

### 2.2 配置飞书机器人

1. **创建飞书机器人**
   - 登录飞书开放平台：https://open.feishu.cn/
   - 创建新应用，选择"机器人"类型
   - 获取应用的 App ID 和 App Secret

2. **配置机器人权限**
   - 在应用功能中启用"机器人"
   - 配置机器人权限：发送消息、接收消息等

3. **获取 Webhook URL**
   - 在机器人配置页面获取 Webhook URL
   - 格式类似：`https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx`

### 2.3 配置 GitHub Secrets

1. 进入你的 Fork 仓库
2. 点击 "Settings" → "Secrets and variables" → "Actions"
3. 点击 "New repository secret"
4. 添加以下 Secret：
   - `FEISHU_WEBHOOK_URL`: 飞书机器人 Webhook URL

### 2.4 配置 RSS 源

编辑 `config/rss_sources.json` 文件，配置你需要的 RSS 源：

```json
{
  "sources": [
    {
      "name": "36氪",
      "url": "https://www.36kr.com/feed",
      "keywords": ["AI", "人工智能", "机器学习", "ChatGPT"],
      "exclude_keywords": ["广告", "推广", "软文"],
      "max_items": 20
    }
  ],
  "global_settings": {
    "max_daily_items": 50,
    "timezone": "Asia/Shanghai",
    "language": "zh-CN"
  }
}
```

### 2.5 启用 GitHub Actions

1. 进入仓库的 "Actions" 页面
2. 点击 "RSS 日报推送" 工作流
3. 点击 "Enable workflow" 启用工作流

## 3. 配置说明

### 3.1 RSS 源配置参数

| 参数 | 说明 | 示例 |
|------|------|------|
| name | 源名称 | "36氪" |
| url | RSS 源地址 | "https://www.36kr.com/feed" |
| keywords | 包含关键词 | ["AI", "人工智能"] |
| exclude_keywords | 排除关键词 | ["广告", "推广"] |
| max_items | 最大获取文章数 | 20 |

### 3.2 全局设置参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| max_daily_items | 每日最大文章数 | 50 |
| timezone | 时区设置 | "Asia/Shanghai" |
| language | 语言设置 | "zh-CN" |

### 3.3 定时任务配置

默认每天上午 9:00（北京时间）执行，可以在 `.github/workflows/rss_daily.yml` 中修改：

```yaml
schedule:
  - cron: '0 1 * * *'  # UTC 时间 1:00，对应北京时间 9:00
```

## 4. 测试和验证

### 4.1 手动触发测试

1. 进入 "Actions" 页面
2. 选择 "RSS 日报推送" 工作流
3. 点击 "Run workflow" 手动触发

### 4.2 检查执行结果

1. 查看工作流执行日志
2. 检查飞书群组是否收到消息
3. 查看生成的报告文件（在 Actions 的 Artifacts 中）

### 4.3 常见问题排查

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 未收到飞书消息 | Webhook URL 错误 | 检查 FEISHU_WEBHOOK_URL 配置 |
| RSS 获取失败 | 网络问题或源地址错误 | 检查 RSS 源地址是否可访问 |
| 筛选结果为空 | 关键词配置不当 | 调整关键词配置 |
| 执行超时 | 网络延迟或源响应慢 | 增加超时时间或减少源数量 |

## 5. 高级配置

### 5.1 自定义筛选规则

可以在 `src/content_filter.py` 中修改筛选逻辑：

```python
def _contains_include_keywords(self, content: str, config: Dict[str, Any]) -> bool:
    # 自定义关键词匹配逻辑
    pass
```

### 5.2 自定义消息格式

可以在 `src/feishu_sender.py` 中修改消息格式：

```python
def _build_interactive_card(self, report: Dict[str, Any]) -> Dict[str, Any]:
    # 自定义卡片样式
    pass
```

### 5.3 添加新的推送平台

可以扩展 `src/feishu_sender.py` 添加其他平台支持：

```python
def send_to_wechat(self, content: str) -> bool:
    # 企业微信推送
    pass

def send_to_dingtalk(self, content: str) -> bool:
    # 钉钉推送
    pass
```

## 6. 监控和维护

### 6.1 日志监控

- 查看 GitHub Actions 执行日志
- 检查 `logs/rss_daily.log` 文件
- 监控飞书机器人消息发送状态

### 6.2 性能优化

- 调整 RSS 源数量
- 优化关键词匹配算法
- 增加缓存机制

### 6.3 定期维护

- 更新 RSS 源地址
- 调整关键词配置
- 清理历史报告文件

## 7. 故障排除

### 7.1 常见错误代码

| 错误代码 | 说明 | 解决方案 |
|----------|------|----------|
| 400 | 请求参数错误 | 检查 Webhook URL 格式 |
| 401 | 认证失败 | 检查机器人配置 |
| 403 | 权限不足 | 检查机器人权限设置 |
| 429 | 请求频率过高 | 降低执行频率 |

### 7.2 联系支持

如果遇到问题，可以：

1. 查看 GitHub Issues
2. 提交新的 Issue
3. 联系项目维护者

## 8. 更新和升级

### 8.1 获取最新版本

```bash
git pull origin main
```

### 8.2 更新依赖

```bash
pip install -r requirements.txt --upgrade
```

### 8.3 测试更新

在更新后，建议：

1. 运行测试用例
2. 手动触发一次工作流
3. 验证功能正常 